# Lolicon 插件

调用 Lolicon API v2 发送随机二次元图片的 QQ 机器人插件。

## 功能特性

- 🖼️ 调用 Lolicon API v2 获取高质量二次元图片
- 💾 本地缓存功能，减少重复下载
- 🔒 R18 内容仅限私聊使用
- 🏷️ 支持单个标签搜索
- 📊 缓存状态管理与 API 状态检查
- ⚡ 并发下载与分批发送，提升多图响应速度

## 安装依赖

```bash
pip install -r requirements.txt
```

## 配置说明

插件当前支持以下配置项（括号内为默认值）：

- `cache_expire`(86400)：缓存过期时间(秒)
- `batch`(5)：单批发送图片数量上限
- `lim_u`(10)：单次请求的图片数量上限
- `api_timeout`(30)：调用 API 的超时时间(秒)
- `download_timeout`(20)：下载图片的超时时间(秒)
- `batch_delay`(0.5)：各批次发送之间的延迟(秒)



## 使用命令

### 用户命令

- `/loli [数量] [标签]` — 发送随机二次元图片
  - 示例：`/loli`、`/loli 3`、`/loli 5 萝莉`、`/loli 萝莉`
  - 只支持单个标签，多个标签时仅使用第一个

- `/r18 [数量] [标签]` — 发送 R18 二次元图片（仅限私聊）
  - 示例：`/r18`、`/r18 3`、`/r18 5 萝莉`、`/r18 萝莉`
  - 只支持单个标签，多个标签时仅使用第一个

**参数说明**：
- 若第一个参数是数字，则作为数量；其后第一个词作为标签
- 若第一个参数不是数字，则其作为标签，数量默认为 1
- 当未提供标签时，默认标签为“萝莉”

### 管理员命令

- `/loli_status` 或 `/状态` — 查看插件状态（包含 API 接口可用性与响应时间）
- `/loli_clear` 或 `/清理缓存` — 清理图片缓存

### 使用限制

- 单次请求最多 10 张（可通过 `lim_u` 配置）
- 多图发送采用分批方式（每批最多 `batch` 张，批间延迟 `batch_delay` 秒）

## 性能说明

- 并发下载：最多 5 个并发任务，加快多图获取速度
- 缓存机制：文件保存于 `plugins/Lolicon/cache/`，索引记录于 `cache_index.json`
- 超时优化：API/下载独立超时设置，失败时有限重试
- API 状态检查：`/loli_status` 命令展示接口可用性与响应时间

## API 说明

本插件调用 [Lolicon API v2](https://docs.api.lolicon.app/#/setu)：

- 接口地址：`https://api.lolicon.app/setu/v2`
- 返回格式：JSON

## 使用示例

### 基础用法
```
/loli                    # 获取 1 张随机图片
/loli 3                  # 获取 3 张随机图片
/loli 萝莉               # 获取 1 张“萝莉”标签图片
/loli 5 可爱             # 获取 5 张“可爱”标签图片
```

### R18（仅限私聊）
```
/r18                     # 获取 1 张 R18 图片
/r18 3                   # 获取 3 张 R18 图片
/r18 御姐                # 获取 1 张“御姐”R18 图片
/r18 5 黑丝              # 获取 5 张“黑丝”R18 图片
```

### 管理员
```
/loli_status             # 查看插件状态和 API 状态
/状态                    # 查看插件状态和 API 状态（别名）
/loli_clear              # 清理图片缓存
/清理缓存                # 清理图片缓存（别名）
```

## 注意事项

1. 只支持单个标签，多个标签时只使用第一个
2. 可通过 `/loli_status` 检查 API 接口状态
3. 合理使用 API，避免频繁请求
4. R18 仅限私聊使用
5. 建议定期清理缓存以节省存储空间
6. 图片版权归原作者所有，请尊重版权